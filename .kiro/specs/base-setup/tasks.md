# 实施计划

## 第一阶段：基础架构搭建

- [x] 1. 安装和配置核心依赖
  - 安装 NestJS 核心依赖包（@nestjs/core, @nestjs/common, @nestjs/microservices）
  - 安装 @doubleshot/nest-electron 和相关依赖
  - 安装 Vue 3 生态依赖（element-plus, pinia, vue-router）
  - 更新 package.json 脚本配置
  - **验收标准**: `pnpm install` 成功执行，所有依赖正确安装，`pnpm run typecheck` 通过
  - **测试方法**: 运行 `pnpm install && pnpm run typecheck` 验证依赖完整性
  - _需求: 1.1, 1.3, 5.1, 5.2, 5.4, 6.5_

- [x] 2. 配置 electron-vite 构建系统
  - 更新 electron.vite.config.ts 支持新的别名配置
  - 配置 TypeScript 编译选项
  - 设置开发环境和生产环境的差异化配置
  - **验收标准**: 构建配置无语法错误，别名解析正常，TypeScript 编译通过
  - **测试方法**: 运行 `pnpm run build` 验证构建流程，检查别名导入是否正常解析
  - _需求: 6.1, 6.2, 6.5_

- [x] 3. 创建 NestJS 微服务启动框架
  - 创建 bootstrap.ts 文件实现 createMicroservice 启动逻辑
  - 实现 ElectronIpcTransport 传输策略配置
  - 创建基础的 AppModule 根模块
  - 配置基础的日志系统集成
  - **验收标准**: NestJS 微服务能够成功启动，日志正常输出，无启动错误
  - **测试方法**: 运行 `pnpm run dev`，检查控制台日志显示 "NestJS 微服务应用启动成功"
  - _需求: 1.1, 1.2, 4.1, 4.2_

- [x] 4. 重构主进程入口文件
  - 修改 src/main/index.ts 集成 NestJS 启动流程
  - 实现应用生命周期管理
  - 配置窗口创建和管理逻辑
  - 添加基础错误处理机制
  - **验收标准**: Electron 应用正常启动，主窗口显示，应用退出时无错误
  - **测试方法**: 启动应用后窗口正常显示，关闭窗口应用正常退出，检查日志无错误信息
  - _需求: 1.4, 6.1_

- [x] 5. 配置 ElectronModule 窗口管理
  - 在 AppModule 中配置 ElectronModule.registerAsync
  - 实现 BrowserWindow 创建工厂函数
  - 配置窗口基础属性和安全设置
  - 设置开发和生产环境的不同加载方式
  - **验收标准**: 窗口通过 NestJS 模块正确创建，安全设置生效，开发环境热重载正常
  - **测试方法**: 检查窗口属性设置，验证 contextIsolation 启用，测试开发环境页面自动刷新
  - _需求: 1.1, 1.5_

## 第二阶段：IPC 通信机制建立

- [x] 6. 创建基础业务模块结构
  - 创建 RegistryModule 模块框架（不实现具体业务逻辑）
  - 创建对应的 Service、Controller 和基础 DTO 类
  - 在 AppModule 中注册新模块
  - **验收标准**: 模块正确注册，依赖注入正常工作，应用启动无模块加载错误
  - **测试方法**: 启动应用检查模块加载日志，在 Controller 中添加测试日志验证依赖注入
  - _需求: 3.1, 3.3_

- [ ] 7. 实现第一个 IPC 控制器
  - 在 RegistryController 中创建简单的 @IpcHandle 方法
  - 实现基础的请求-响应通信测试
  - 添加基础的参数验证和错误处理
  - **验收标准**: IPC 方法能够接收参数并返回响应，错误能够正确传播
  - **测试方法**: 在控制器中创建返回固定值的测试方法，验证参数传递和响应返回
  - _需求: 2.1, 2.4, 2.6_

- [ ] 8. 配置 Preload 脚本 API 暴露
  - 重构 src/preload/index.ts 暴露业务 API
  - 创建类型安全的 API 接口定义
  - 实现 contextBridge 安全暴露机制
  - 创建 types.d.ts 类型定义文件
  - **验收标准**: 渲染进程能够访问 window.api，TypeScript 类型提示正常工作
  - **测试方法**: 在渲染进程控制台测试 window.api 对象存在，IDE 中验证类型提示
  - _需求: 2.4, 2.5_

- [ ] 9. 验证 IPC 通信功能
  - 创建简单的测试用例验证主进程到渲染进程通信
  - 测试错误传播机制是否正常工作
  - 验证类型定义是否正确生效
  - **验收标准**: 渲染进程能够成功调用主进程方法并获得响应，错误能够正确捕获
  - **测试方法**: 在渲染进程中调用 API 方法，检查返回值和错误处理，验证 TypeScript 类型检查
  - _需求: 2.1, 2.2, 2.6, 7.2_

## 第三阶段：Vue 3 前端架构升级

- [ ] 10. 升级 Vue 3 应用入口
  - 重构 src/renderer/src/main.ts 使用 Vue 3 API
  - 集成 Element Plus 组件库
  - 配置 Pinia 状态管理
  - 设置 Vue Router 4 路由系统
  - **验收标准**: Vue 3 应用正常启动，Element Plus 组件可用，路由和状态管理正常工作
  - **测试方法**: 页面显示 Element Plus 组件，路由跳转正常，Pinia store 状态更新正常
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [ ] 11. 创建基础页面结构
  - 重构 App.vue 使用 Element Plus 布局组件
  - 创建简单的导航菜单和路由结构
  - 实现基础的主题切换功能（简化版）
  - **验收标准**: 页面布局正常显示，导航菜单可点击，主题切换功能正常工作
  - **测试方法**: 点击导航菜单验证路由跳转，切换主题验证样式变化，检查响应式布局
  - _需求: 5.5, 7.4_

- [ ] 12. 实现第一个业务页面
  - 创建简单的仓库管理页面
  - 使用 Pinia store 管理页面状态
  - 调用 IPC API 进行数据交互测试
  - 实现基础的加载状态和错误处理
  - **验收标准**: 页面能够调用 IPC API，状态正确更新，加载和错误状态正常显示
  - **测试方法**: 触发 API 调用验证数据更新，测试加载状态显示，模拟错误验证错误处理
  - _需求: 5.3, 7.4_

- [ ] 13. 配置开发环境工具
  - 配置 ESLint 和 Prettier 代码规范检查
  - 设置 TypeScript 类型检查流程
  - 配置开发环境热重载功能
  - 添加基础的单元测试配置
  - **验收标准**: `pnpm run lint` 通过，`pnpm run typecheck` 通过，热重载正常工作
  - **测试方法**: 运行 lint 和 typecheck 命令验证通过，修改代码验证热重载效果
  - _需求: 6.2, 6.3, 6.4_

## 第四阶段：功能验证和优化

- [ ] 14. 端到端功能测试
  - 测试应用完整的启动流程
  - 验证主进程和渲染进程间的数据流
  - 测试错误处理和恢复机制
  - 验证构建和打包流程
  - **验收标准**: 应用从启动到关闭全流程无错误，数据流正常，构建产物可正常运行
  - **测试方法**: 完整启动关闭应用，测试所有 IPC 通信，运行 `pnpm run build` 验证构建
  - _需求: 7.1, 7.2, 7.3, 7.6_

- [ ] 15. 性能和用户体验优化
  - 优化应用启动时间
  - 实现基础的加载状态反馈
  - 优化 IPC 通信性能
  - 添加基础的用户操作反馈
  - **验收标准**: 应用启动时间 < 3秒，操作有明确反馈，无明显性能问题
  - **测试方法**: 测量启动时间，验证加载状态显示，检查操作响应速度和反馈
  - _需求: 6.1, 7.4, 7.5_

- [ ] 16. 代码质量检查和文档完善
  - 运行完整的 lint 检查并修复所有问题
  - 确保所有 TypeScript 类型检查通过
  - 添加关键功能的代码注释
  - 更新项目 README 和开发文档
  - **验收标准**: `pnpm run lint` 零错误，`pnpm run typecheck` 通过，文档完整准确
  - **测试方法**: 运行所有代码质量检查命令，审查代码注释完整性，验证文档准确性
  - _需求: 6.2, 6.3_

- [ ] 17. 构建和部署验证
  - 测试开发环境构建流程
  - 验证生产环境构建和打包
  - 测试不同平台的兼容性
  - 确保构建产物的完整性和正确性
  - **验收标准**: 构建无错误，打包产物可正常运行，支持目标平台
  - **测试方法**: 运行 `pnpm run build` 和打包命令，测试构建产物启动和基本功能
  - _需求: 6.5, 7.1_