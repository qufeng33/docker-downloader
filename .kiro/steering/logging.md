# 日志管理规范

## electron-log 集成规范

### 基础配置要求

- 必须使用 electron-log 作为项目唯一的日志管理解决方案
- 主进程和渲染进程必须使用统一的日志配置
- 日志配置必须在应用启动的最早阶段完成初始化
- 日志配置必须支持开发环境和生产环境的差异化设置

### 跨进程日志支持要求

- 主进程日志必须直接使用 electron-log
- 渲染进程日志必须通过 IPC 转发到主进程
- preload 脚本必须提供渲染进程日志接口
- 所有进程的日志必须统一格式和输出目标

### 日志传输配置要求

- 日志必须同时输出到控制台和文件
- 控制台日志必须支持颜色和格式化显示
- 文件日志必须使用结构化格式便于解析
- 远程日志传输必须可选配置（如需要）

## 日志级别管理

### 级别定义要求

- 必须支持 ERROR、WARN、INFO、DEBUG 四个标准级别
- ERROR：系统错误、异常和故障
- WARN：警告信息、潜在问题
- INFO：重要的业务流程信息
- DEBUG：详细的调试和跟踪信息

### 级别控制要求

- 开发环境默认日志级别必须设置为 DEBUG
- 生产环境默认日志级别必须设置为 INFO
- 日志级别必须支持运行时动态调整
- 不同模块必须支持独立的日志级别配置

### 级别使用规范

- 业务流程关键节点必须使用 INFO 级别记录
- 错误和异常必须使用 ERROR 级别记录
- 性能警告和资源警告必须使用 WARN 级别记录
- 详细的调试信息必须使用 DEBUG 级别记录

## 日志格式规范

### 基础格式要求

- 日志格式必须包含时间戳、级别、进程类型、模块名和消息内容
- 时间戳必须使用 ISO 8601 格式
- 模块名必须明确标识日志来源
- 消息内容必须结构化且易于阅读

### 结构化日志要求

- 复杂数据必须使用 JSON 格式记录
- 关键业务数据必须包含完整的上下文信息
- 错误日志必须包含错误类型、消息和堆栈信息
- 性能日志必须包含执行时间和资源使用情况

### 格式一致性要求

- 同类型的日志必须使用一致的格式
- 日志字段命名必须遵循统一的命名规范
- 日志消息必须使用中文描述，便于理解
- 技术术语必须保持英文原文

## 日志文件管理

### 文件组织要求

- 日志文件必须按日期和级别进行分类存储
- 主日志文件必须包含所有级别的日志
- 错误日志必须单独存储便于快速定位问题
- 调试日志必须可选择性启用和存储

### 文件轮转要求

- 日志文件必须支持基于大小的自动轮转
- 单个日志文件大小不得超过 10MB
- 历史日志文件必须支持压缩存储
- 日志文件保留期限必须可配置（默认 30 天）

### 文件权限要求

- 日志文件必须设置适当的文件权限
- 日志目录必须仅允许应用程序访问
- 敏感日志文件必须加密存储
- 日志文件访问必须记录审计信息

## 业务日志规范

### 用户操作日志要求

- 重要的用户操作必须记录操作日志
- 操作日志必须包含用户标识、操作类型、时间和结果
- 敏感操作必须记录详细的审计信息
- 操作失败必须记录失败原因和上下文

### 系统事件日志要求

- 应用启动和关闭必须记录系统事件
- 配置变更必须记录变更前后的值
- 网络连接状态变化必须记录
- 资源使用异常必须记录警告信息

### 业务流程日志要求

- 镜像搜索和下载流程必须记录关键节点
- 仓库连接和认证过程必须记录状态信息
- 文件操作和数据处理必须记录处理结果
- 错误恢复和重试机制必须记录执行情况

## 性能和安全考虑

### 性能优化要求

- 日志记录不得显著影响应用性能
- 大量日志输出必须使用异步处理
- 日志缓冲必须合理配置避免内存溢出
- 日志文件 I/O 必须优化减少磁盘压力

### 安全保护要求

- 敏感信息必须在记录前进行过滤和脱敏
- 密码、令牌、密钥等信息严禁记录到日志
- 个人隐私信息必须进行匿名化处理
- 日志传输必须使用安全通道

### 监控和告警要求

- 错误日志必须支持实时监控和告警
- 异常模式必须支持自动检测和通知
- 日志统计信息必须定期生成和分析
- 日志系统本身的健康状态必须监控

## 开发和调试支持

### 开发环境日志要求

- 开发环境必须启用详细的调试日志
- 调试日志必须包含完整的执行路径信息
- IPC 通信必须记录详细的调用信息
- 数据库操作必须记录 SQL 语句和执行时间

### 调试工具集成要求

- 日志查看器必须支持实时日志流显示
- 日志过滤必须支持多种条件组合
- 日志搜索必须支持正则表达式
- 日志导出必须支持多种格式

### 测试环境日志要求

- 测试环境必须使用独立的日志配置
- 测试日志必须包含测试用例标识
- 测试失败必须记录详细的失败信息
- 测试覆盖率必须包含日志记录的覆盖情况
